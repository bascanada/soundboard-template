# Technical Specifications: SounboardTemplate

This document details the architecture and functionality of the SounboardTemplate project. It serves as a guide for implementation and maintenance.

### 1. Vision & Project Structure

* **Objective:** To provide an open-source starter kit that allows anyone to easily create and publish a modern, high-performance, and customizable soundboard website.

* **Philosophy:** 100% static. The project generates a blazing-fast website with no backend or database, which can be hosted for free on platforms like GitHub Pages, Vercel, or Netlify.

* **Project Language:** All code, comments, and documentation will be in **English**.

* **Repository Structure:**

  * `/template`: The core SvelteKit project, ready to be copied and customized.

  * `/example`: A complete example site (e.g., about Marc Tanguay) that uses the template. It serves as a demo and will be deployed automatically via GitHub Actions.

#### 1.1. Example File Structure

After setup and running `npm run generate`, the `/template` directory will look like this:

```
/template
├── .github/
│   └── workflows/
│       └── deploy.yml
├── static/
│   ├── db.json          # Generated by script
│   ├── favicon.png
│   └── media/           # Generated by script
│       └── first-clip-1/
│           ├── audio.mp3
│           └── thumbnail.jpg
├── src/
│   ├── lib/
│   │   ├── types.ts     # Core interfaces
│   │   └── site.config.js
│   └── routes/
│       ├── +page.svelte
│       └── +page.js
├── config.js            # User-edited clip definitions
├── scripts/
│   └── generate-clips.js # The Node.js extraction script
└── package.json
```

### 2. Part 1: The Extraction Scripts

The scripts automate the creation of the soundboard's content.

#### 2.1. Implementation Details & Requirements

* **Technology:** The scripts will be written in **Node.js** to maintain a consistent JavaScript/TypeScript ecosystem. They will use Node's `child_process` module to execute command-line tools.

* **Dependencies:** The user must have **`yt-dlp`** and **`ffmpeg`** installed and available in their system's PATH. The script will check for the existence of these tools on startup and provide a clear error message with installation links if they are not found.

* **Error Handling:**

  * The script will wrap critical operations (video download, clip processing) in `try...catch` blocks.

  * If a single clip fails to process (e.g., invalid timestamp), the script will log a detailed error to the console and **continue to the next clip**.

  * A summary of any failed clips will be displayed at the end of the process.

* **Clip ID Generation:**

  * Clip IDs are generated automatically to ensure uniqueness.

  * **Algorithm:**

    1. Take the clip's `title` (e.g., "First Clip!").

    2. Convert to lowercase: `"first clip!"`.

    3. "Slugify" it by replacing spaces with hyphens and removing special characters: `"first-clip"`.

    4. Append a unique, incrementing number (e.g., `-1`, `-2`) to guarantee no duplicates across the entire project.

  * **Example:** `first-clip-1`, `another-great-clip-2`.

* **Audio Handling in Video Clips:**

  * To ensure perfect audio/video synchronization and simplify the frontend player, the audio track **will be included** directly within the `.webm` file.

#### 2.2. FFmpeg Commands

* **For `audio.mp3`:**

  ```
  ffmpeg -i "input.mp4" -ss [START] -to [END] -vn -c:a libmp3lame -q:a 2 "output/audio.mp3"
  
  ```

* **For `video.webm`:**

  ```
  ffmpeg -i "input.mp4" -ss [START] -to [END] -c:v libvpx-vp9 -crf 31 -b:v 0 -c:a libopus -b:a 128k "output/video.webm"
  
  ```

* **For `thumbnail.jpg`:**

  ```
  ffmpeg -ss [START] -i "input.mp4" -vframes 1 -q:v 2 "output/thumbnail.jpg"
  
  ```

#### 2.3. Configuration File (`config.js`)

```
export default {
  sources: [
    {
      videoUrl: "[https://www.youtube.com/watch?v=VIDEO_ID_1](https://www.youtube.com/watch?v=VIDEO_ID_1)",
      clips: [
        { title: "First clip", category: "Category A", start: "0:42", end: "0:45" },
        { title: "Clip with video", category: "Category B", start: "1:52", end: "1:58", video: true },
      ]
    },
  ]
};

```

#### 2.4. Database Generation

* **Generation:** The `db.json` file is the final artifact produced by the extraction scripts when `npm run generate` is executed.

* **Location:** The file is saved at `static/db.json` within the SvelteKit project structure.

#### 2.5. Script Workflow Clarification

* The `npm run generate` command is a **manual pre-build step**, not part of the SvelteKit build process itself.
* **Workflow:**
    1. User modifies `config.js` to change content.
    2. User runs `npm run generate` **manually**. This can be slow.
    3. User runs `npm run dev` or `npm run build`. This is fast as it only compiles the application code using the already-generated media.
* This separation is intentional to maintain a fast development loop.

### 3. Part 2: The SvelteKit Template

* **Technical Stack:**

  * **Framework:** SvelteKit

  * **Language:** TypeScript

  * **Styling:** Tailwind CSS

  * **UI Components:** Skeleton UI (**Must** use v3 **documentation**)

* **Styling Guidelines:**

  * **Priority Order:**

    1. **Skeleton UI Components & Props**

    2. **Tailwind** CSS Utility **Classes**

    3. **Custom CSS Classes** (only as a last resort)

#### 3.1. Core TypeScript Interfaces

To ensure type safety, the following interfaces will be defined in `src/lib/types.ts`.

* **`Clip`**:
  ```typescript
  export interface Clip {
    id: string;
    title: string;
    category: string;
    audioSrc: string;
    videoSrc: string | null;
    thumbnailSrc: string;
  }
  ```

* **`Database`**:
  ```typescript
  import type { Clip } from './types';
  
  export interface Database {
    categories: string[];
    clips: Clip[];
  }
  ```

* **`SiteConfig`**:
  ```typescript
  export interface SiteConfig {
    title: string;
    favicon: string;
    theme: string;
  }
  ```

#### 3.2. Site Configuration & Theming

* **Configuration File (`src/lib/site.config.js`):**
  ```javascript
  export default {
    title: "My Awesome Soundboard",
    favicon: "/favicon.png",
    theme: "modern"
  };
  ```
* **Theme Mapping:** The `theme` property in `site.config.js` directly corresponds to the filename of a Skeleton UI theme. The application's root layout will dynamically import the correct CSS file based on this string (e.g., `theme: 'modern'` will import `@skeletonlabs/skeleton/themes/theme-modern.css`).

#### 3.3. Component Specification: `Clip.svelte`

This component is the core interactive element.

* **Structure (HTML/Svelte):**
  * A main container `<div>` (e.g., `100px` x `100px`).
  * An inner `<div>` for the circular media (`<img>` or `<video>`).
  * An overlay `<svg>` element for the progress border.

* **States:** `idle`, `playing`, `paused`, `viewed`.

* **Visuals & Styling (SVG Approach):**
  * The SVG will contain a background `<circle>` (grey track) and a progress `<circle>`.
  * **Gradient:** A `<linearGradient>` defined in `<defs>` will be applied to the progress circle's stroke.
  * **Idle State:** Full gradient border is visible.
  * **Viewed State:** Border becomes solid grey.

* **Behavior & Animation:**
  * **Progress Bar:** The `stroke-dashoffset` of the progress circle will be animated from `C` to `0` based on the audio's `currentTime` and `duration`.

#### 3.4. Interaction Logic & Edge Cases

* **Category Filtering:** Uses **OR logic**. A clip is shown if it matches **any** selected category.
* **Playback Model:** **Single clip focus**. Clicking a new clip stops any currently playing clip.
* **Click Behavior:** `idle` -> `playing` -> `paused` -> `playing`.
* **Mobile Autoplay:** Playback is **only** initiated by a direct user tap, ensuring compliance.

### 4. Deployment

#### 4.1. GitHub Pages

Deployment requires setting the `base` path in `vite.config.js` and using a specific GitHub Actions workflow to build and deploy to the `gh-pages` branch.

#### 4.2. Vercel

Deployment is simpler. Import the Git repository into Vercel, and it will auto-detect the SvelteKit settings and deploy on each push to `main`.

